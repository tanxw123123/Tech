## 1.cc攻击

​        CC攻击是DDOS(分布式拒绝服务)的一种，相比其它的DDOS攻击CC似乎更有技术含量一些。**这种攻击你见不到虚假IP，见不到特别大的异常流量**，但造成服务器无法进行正常连接，一条ADSL的普通用户足以挂掉一台高性能的Web服务器。由此可见其危害性，称其为"Web杀手"毫不为过。

CC攻击:利用大量代理服务器对目标计算机发起大量连接，导致目标服务器资源枯竭造成拒绝服务。

CC攻击的原理是通过代理服务器或者大量肉鸡模拟多个用户访问目标网站的动态页面，制造大量的后台[数据库](https://cloud.tencent.com/solution/database?from=10680)查询动作，消耗目标CPU资源，造成拒绝服务。

CC攻击模拟多个用户(多少线程就是多少用户)不停的进行访问(访问那些需要大量数据操作，就是需要大量CPU时间的页面).这一点用一个一般的性能测试软件就可以做到大量模拟用户并发。

CC攻击（Challenge Collapsar）是DDOS（分布式拒绝服务）的一种，也是一种常见的网站攻击方法，攻击者通过代理服务器或者肉鸡向向受害主机不停地发大量数据包，造成对方服务器资源耗尽，一直到宕机崩溃。

**DDOS是主要针对IP的攻击，而CC攻击的主要是网页**。CC攻击相对来说，攻击的危害不是毁灭性的，但是持续时间长；而**DDOS攻击就是流量攻击**，这种攻击的危害性较大，通过向目标服务器发送大量数据包，耗尽其带宽，需要足够的带宽和硬件防火墙才能防御。

HTTP/CC 攻击的特点：

- HTTP/CC 攻击的 ip 都是真实的，分散的

- HTTP/CC 攻击的数据包都是正常的数据包

- HTTP/CC 攻击的请求都是有效请求，且无法拒绝

- HTTP/CC 攻击的是网页，服务器可以连接，ping 也没问题，但是网页就是访问不了

高效的 HTTP/CC 攻击 应不断发出针对不同资源和页面的 HTTP 请求，并尽可能请求无法被缓存的资源



防御：

限流

缓存

​        HTTP/CC 攻击 防御主要通过缓存的方式进行，尽量由设备的缓存直接返回结果来保护后端业务。当高级攻击者穿透缓存时，清洗设备会截获 HTTP 请求做特殊处理。因为CC攻击通过工具软件发起，而普通用户通过浏览器访问，这其中就会有某些区别。想办法对这二者作出判断，选择性的屏蔽来自机器的流量即可。

```shell
# 初级
    普通浏览器发起请求时，除了要访问的地址以外，Http头中还会带有Referer，UserAgent等多项信息。遇到攻击时可以通过日志查看访问信息，看攻击的流量是否有明显特征，比如固定的Referer或UserAgent，如果能找到特征，就可以直接屏蔽掉了。
    
# 中级
    如果攻击者伪造了Referer和UserAgent等信息，那就需要从其他地方入手。攻击软件一般来说功能都比较简单，只有固定的发包功能，而浏览器会完整的支持Http协议，我们可以利用这一点来进行防御。

    首先为每个访问者定义一个字符串，保存在Cookies中作为Token，必须要带有正确的Token才可以访问后端服务。当用户第一次访问时，会检测到用户的Cookies里面并没有这个Token，则返回一个302重定向，目标地址为当前页面，同时在返回的Http头中加入set cookies字段，对Cookies进行设置，使用户带有这个Token。

    客户端如果是一个正常的浏览器，那么就会支持http头中的set cookie和302重定向指令，将带上正确的Token再次访问页面，这时候后台检测到正确的Token，就会放行，这之后用户的Http请求都会带有这个Token，所以并不会受到阻拦。

    客户端如果是CC软件，那么一般不会支持这些指令，那么就会一直被拦在最外层，并不会对服务器内部造成压力。

# 高级

```

---

## 2.DDOS攻击

什么是DDoS？

“你开了一间饭馆，我花钱雇了很多人冲进你的饭馆，占了你的餐位，纠缠你的服务员，但就是不点吃的。这样一来，真正想消费的顾客进不去，你就没有办法提供服务。”

**常见ddos攻击类型：**

```shell
# syn flood攻击   目标：web服务器
TCP三次握手过程
- 开始建立连接时，客户端发送SYN报文到服务器，等待服务器确认。SYN报文的源IP地址和端口是客户端的IP地址和端口。
- 服务器收到SYN报文，回应一个SYN-ACK（Synchronize-Acknowledgement）报文。SYN-ACK报文的目的IP地址和端口是客户端的IP地址和端口。
- 客户端收到服务器的SYN-ACK报文，向服务器发送ACK报文，服务器收到ACK报文后完成三次握手，TCP连接建立成功。

    在连接超时之前，服务器会一直等待ACK报文，此时该连接状态为半开放连接（也被称为半连接）。半连接会占用服务器的连接数，当连接数被占满时，服务器就无法提供正常的服务了。黑客正是通过这个机制来实现SYN Flood。
    黑客通常通过伪造的源IP地址或端口，向服务器发送大量的SYN报文，请求建立TCP连接。由于源IP地址或端口是伪造的，服务器发送的SYN-ACK报文永远不会被真实的客户端接收和回应。
    
# syn flood防御
- 源认证：
    Anti-DDoS系统拦截客户端发送的SYN报文，代替服务器向客户端发送SYN-ACK报文，如果客户端不应答，则认为该客户端为虚假源；如果客户端应答，则Anti-DDoS系统认为该客户端为真实源，并将其IP地址加入白名单，在一段时间允许该源发送的所有SYN报文通过，也不做代答。
    
- 首包丢弃
    如果Anti-DDoS系统代替服务器应答了所有的SYN Flood攻击报文，那么性能瓶颈仅仅是从服务器转移到了Anti-DDoS系统而已。一旦Anti-DDoS系统的系统资源耗尽，攻击依旧会透传到服务器，而且大量反弹的SYN-ACK报文也会对网络造成一定的压力。Anti-DDoS系统利用首包丢弃来解决这个问题。

    TCP协议的可靠性不仅体现在三次握手，还体现在超时与重传的机制。正常情况下客户端发送SYN报文后如果在一定时间没有收到服务器的SYN-ACK应答，客户端会重新发送SYN报文。Anti-DDoS系统会丢弃掉收到的第一个SYN报文。SYN Flood攻击时，黑客发送的绝大多数是变源的SYN报文，所有的SYN报文对于Anti-DDoS系统来说都是首包，都将被直接丢弃。如果客户端重传了SYN报文，Anti-DDoS系统再对该报文进行源认证。如此一来，大大减少了Anti-DDoS系统代答的压力。首包丢弃和源认证两种手段结合，对于防御SYN Flood（特别是不断变换源IP和源端口的虚假源攻击）非常有效。
```

```shell
# UDP flood攻击   目标：各种服务器   流量攻击
    传统UDP Flood攻击是一种消耗攻击和被攻击双方资源的带宽类攻击方式。攻击者通过僵尸网络向目标设备发送大量伪造的UDP报文，这种报文一般为大包且速率非常快，通常会造成链路拥塞甚至网络瘫痪的危害。这种攻击方式由于技术含量较低，现在已经越来越少被使用。
- 反射
    在UDP协议中，正常情况下，客户端发送请求包到服务器，服务器返回响应包给客户端，一次交互就已完成，中间没有校验过程。反射攻击正是利用了UDP协议面向无连接、缺少源认证机制的特点，将请求包的源IP地址篡改为攻击目标的IP地址，最终服务器返回的响应包就会被送到攻击目标，形成反射攻击。
    
- 放大
    攻击者通常利用互联网的基础架构来进行放大攻击。由于网络中开放的NTP服务器非常多，攻击者会利用僵尸主机同时向NTP服务器发起大量的Monlist请求，1个Monlist请求包可以引发100个响应包。通常1个NTP请求包只有90字节的大小，而1个回应报文通常为482字节，100个回应报文就是48200字节，可以发现回应报文是请求报文的500倍左右，这就形成了四两拨千斤的放大攻击，最终造成链路拥塞甚至网络瘫痪。
    
# UDP flood防御
    由攻击工具伪造的攻击报文通常都拥有相同的特征字段，比如都包含某一字符串或整个报文内容一致，而对于UDP反射放大攻击中那些由真实网络设备发出的报文，在数据段不具备相同特征，但其目的端口都是固定的，所以不难发现UDP Flood攻击报文都具有一定的特征。确定攻击报文的特征后即可进行过滤，特征过滤也就是常说的指纹过滤。指纹过滤包括静态指纹过滤和动态指纹学习两种方法。
    关闭不必要的端口
    
# NTP 攻击防范配置方法
1.升级版本
Linux 系统中的 ntpd 4.2.7p26 及之后的版本关闭了 monlist 请求功能。升级到 ntpd
4.2.7p26 或更高版本可以避免针对该漏洞的攻击。

2. 禁用或限制状态查询
a) 在 Linux 系统下，如果 monlist 功能开放，可尝试通过修改 ntp.conf 配置文件解决问
题，具体操作建议是在上述文件中增加下面的配置：
IPV4: restrict default kodnomodifynotrapnopeernoquery
IPv6: restrict -6 default kodnomodifynotrapnopeernoquery
另外，还可以配置限制访问命令，如：restrict default noquery。

# SSDP简单服务发现
- cmd执行： scconfig SSDPSRV start=DISABLED
- 在“服务和应用程序”中点击“服务”，找到“SSDP Discovery”服务，双击后该服务后选择“禁用”选项。
防火墙禁用UDP 1900
```

```shell
# ICMP flood攻击   目标：各种服务器    流量攻击
    攻击者向一个子网的广播地址发送多个ICMP Echo请求数据包。并将源地址伪装成想要攻击的目标主机的地址。然后该子网上的所有主机均会对此ICMP Echo请求包作出答复，向被攻击的目标主机发送数据包，使此主机受到攻击，导致网络阻塞。
    
# ICMP flood防御
禁ping
```

的咖啡机啦

```shell
# DHCP flood   目标：DHCP服务器
```

```shell
# mac flood    目标：交换机
```



```shell
# ddos攻击实战
1. pentmenu
包含大部分的flooding攻击模块

$ git clone https://....../pentmenu
$ cd pentmenu
$ ./pentmenu

2. dhcpig
功能：dhcp flood攻击
插件：scapy

下载 https://github/secdev/scapy
解压scapy-master.zip并进入
python setup.py install 安装

下载 https://github.com/kamorin/DHCPig
解压dhcpig-master.zip并进入解压目录
python setup.py install安装

使用方法：pig.py eth0

macof
mac flood
插件：scapy

ab
ab -c 10 -n 10
```

```
DDOS防御：

cdn：分布式对抗分布式。缺点：如果某个cdn节点被攻破，泄露了真实ip，整个网络形同虚设。

高防服务器：可以暴露真实ip（高防服务器ip），真实业务服务器与高防服务器以内网方式连接，不会暴露在公网中。缺点： 贵

为什么贵？

普通电脑的网卡通常只有1G，而服务器硬件也就10G-40G。所以要处理上百G的流量，需要多网卡负载均衡架构。针对超大流量，cpu处理能力也非常重要，毕竟流量清洗就是识别网络中的异常流量。都是依赖设备自身算力去实现。

流量清洗原理：
流量----》流量清洗设备----》抗cc防火墙----》内网（被保护的服务器）

TCP和UDP协议的洪水或者反射攻击都是有迹可循，所以现在很少有人用这种方式攻击了，通常应用一些固定的规则就可以过滤了。
而cc防火墙对抗的是应用层，识别基于http的cc攻击，通常是识别http的header是否合法。

采用cdn技术分流大图片和文件下载，
采用验证码机制对高IO的请求做限制，例如：用户注册，搜索功能等
对相同ip的连接数做限制

```



## 3.两者对比

ddos攻击主要是针对IP，针对IP进行发送大量报文进行攻击，导致服务器过载，一个IP的正常流量是有限的，如果被长期占用带宽过大那么就会直接导致服务器直接宕机，那么正常用户干脆直接访问不了服务器，也没有办法进行正常业务

cc攻击呢主要就是模仿真人去访问服务器的数据库，导致服务器内存直接爆炸，其实在业内来说，cc攻击比ddos还难处理一些，cc攻击有很多种攻击的方式而且多样化，导致cc防护有时候要花更多的钱去做防御